@page
@using Microsoft.AspNetCore.Http
@model NHLCafe.Pages.AllesBetalen

@{
}

<h1 class="display-4">Rekening</h1>

<div class="container">
    <div class="row">
        <div class="col-4">
            <p><strong>Product</strong></p>
        </div>
        <div class="col-2">
            <p><strong>Nog te betalen</strong></p>          
        </div>
        <div class="col-3">
            <p><strong>Prijs</strong></p>          
        </div>
        <div class="col-3">
            <p><strong>Totaal</strong></p>            
        </div>
    </div> 
    
    @foreach (var productEntry in Model.SelectedProducts)
    {
        <div class="row listEntry">
            <div class="col-4 list-group addedProducts">
                <button class="list-group-item m-1 listProduct" value="@productEntry.ProductName">@productEntry.ProductName</button>
            </div>
                                                          
            <div class="col-2 addedCounter">
                <input readonly class="col-3 counter" style="border: none" value="@HttpContext.Session.GetInt32("count" + productEntry.ProductId)"/>
            </div>
            <div class="col-3 list-group">
                <input readonly type="text" class="list-group-item m-1 price" value="@productEntry.Price"/>
            </div>
            <div class="col-3 list-group">
                <input readonly type="text" class="list-group-item m-1 totalPrice" value=""/>
            </div>
        </div>
    }
    <div class="row">
        <div class="col-9"></div>
        <div class="col-3 list-group">
            <input readonly type="text" class="list-group-item m-1 endTotalPrice" value=""/>
        </div>
    </div>
    <div class="row">
        <div class="col-9"></div>
        <div class="col-3">
            <a class="btn btn-primary float-end m-1" asp-area="" asp-page="TableSelect">Betalen</a>
        </div>
    </div>
</div>

<script>
$(document).ready(function(){
    var endTotalPrice = 0;
    $('.totalPrice').each(function ()
    {
        var total = parseFloat($(this).parent().parent().find('.price').val() * $(this).parent().parent().find('.counter').val()).toFixed(2);
        $(this).val(total);
        
        endTotalPrice += parseFloat($(this).val());
    })
    $('.endTotalPrice').val(endTotalPrice.toFixed(2));
});
</script>